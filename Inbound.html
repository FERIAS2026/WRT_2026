<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pedido de F√©rias 2026</title>
<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    height: 100vh;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding-top: 40px;

    /* üî• IMAGEM DE FUNDO */
    background-image: url("FUNDO.jpg");
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center center;
    background-attachment: fixed;
    color: #0f3d2e;
}
#passwordPrompt, #formContainer {
    background-color: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(15, 61, 46, 0.2);
    max-width: 400px;
    width: 100%;
    margin-bottom: 20px;
}
label { display: block; margin-bottom: 10px; color: #0f3d2e; }
select, input[type="date"], input[type="password"] {
    padding: 8px; margin-bottom: 15px; width: 100%;
    border: 1px solid #0f3d2e; border-radius: 6px;
    background-color: #f8fdfb; color: #0f3d2e;
}
button {
    padding: 10px 15px; background-color: #0f3d2e; color: white;
    border: none; border-radius: 6px; cursor: pointer; margin-top: 10px;
}
button:hover { background-color: #0c3326; }
.error { color: #a33; margin-top: 10px; display: none; }
.success { color: green; font-weight: bold; margin-top: 15px; }
#formContainer { display: none; }
h1, h2 { text-align: center; }
#resumoPedidos div {
    border: 1px solid #0f3d2e;
    padding: 10px;
    margin-top: 10px;
    border-radius: 6px;
    background-color: #e6ffec;
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="passwordPrompt">
<h1>EQUIPA INBOUND</h1>
<label for="password">Password de Acesso:</label>
<input type="password" id="password" required>
<button id="btnEntrar">Entrar</button>
<div id="senhaErro" class="error">Senha incorreta. Tente novamente.</div>
</div>

<!-- FORMUL√ÅRIO -->
<div id="formContainer">
<h1>Equipa INBOUND</h1>

<form id="reservaForm">
<label for="nome">Nome:</label>
<select id="nome" required>
    <option></option>
<option>Adriana Fiorani Ferreira</option>
<option>Afonso Guilherme Larrier Kroner Torres Nunes</option>
<option>Alberto Dos Santos Fritsch</option>
<option>Ana Beatriz Pereira Foitinho Resina De Oliveira</option>
<option>Ana Carolina Mota Ferreira</option>
<option>Ana Filipa Mendes Do Carmo</option>
<option>Ana Pedro de Mendon√ßa Batista dos Santos</option>
<option>Ana Raquel Ferreira Da Fonseca</option>
    <option>Ana Raquel Ferreira Pico Martins</option>
<option>Ana Rute da Silva Fernandes Dur√£o</option>
<option>Ana Sofia Sanches Coelho da Cunha de Oliveira</option>
<option>Ana Teresa Da Costa Leonardo Neves</option>
<option>Andreia Cristina Silvestre Ferreira Da Silva Bernardes</option>
<option>Andreia Lorena Matos Pereira</option>
<option>Andreia Meireles Costa</option>
<option>B√°rbara Cristina Machado Fernandes</option>
<option>Beatriz De Jesus Pimentel</option>
<option>Beatriz De Oliveira Guimar√£es</option>
<option>Beatriz Santana Pereira </option>
<option>Bruno Pinto da Silva</option>
<option>Carina Brito Oliveira Duarte</option>
<option>C√°tia Filipa Nunes Rodrigues</option>
<option>Christian Acampora</option>
<option>Cintia Maisa Gomes Carlos</option>
<option>Claudia Nogueira Gon√ßalves</option>
<option>Clotilde De Jesus Pires Maciel Neto</option>
<option>Cristiane Andrea e Paiva</option>
<option>Constan√ßa De Freitas Lima Monteiro Lopes</option>
<option>Daiana Mangolin De Oliveira Ghenov</option>
<option>Daniel Andrade Pires Belas Brand√£o</option>
<option>Daniel Eduardo Henriques Pinheiro</option>
<option>Darlene Do Nascimento Lima Ching Fong</option>
<option>Delson da Silva Carvalho</option>
<option>Diana Da Silva Ferreira</option>
<option>Dyovana Gon√ßalves Farias</option>
<option>Eunice Rosalina Moiane Machatine Chiau</option>
<option>Emeli Santana da Silva</option>
<option>Fabiana Dos Reis Moreira</option>
<option>F√°tima Leticia Barbosa Coutinho</option>
<option>Filipa Alexandra Nogueira Leit√£o</option>
<option>Fl√°via Passos Messias</option>
<option>Helga Maria Fernandes Levy Lopes</option>
<option>Hellen Priscilla De Freitas P√™go Saless</option>
<option>Hugo Miguel dos Santos Pombo</option>
<option>Isabel Alexandra B√°rtolo Louren√ßo Lopes</option>
<option>Ivo Miguel Cardoso Pereira</option>
<option>Jaine Hanara Evangelista dos Santos</option>
<option>Jaqueline de Freitas Andrade Maia</option>
<option>Jaqueline Elias de Lima</option>
<option>Jessica Silva Nogueira Manacas</option>
<option>Joana Gabriela de Paiva da Silva</option>
<option>Joana Gomes Neves Tomaz</option>
<option>Jo√£o Pedro Reis Almeida</option>
    <option>Jo√£o Pedro Concei√ß√£o Borges</option>

<option>Jorge Miguel Santos de Seixas</option>
<option>Jorge Tiago Miranda Nogueira</option>
<option>Jos√© Filipe Miranda Monteiro</option>
<option>Jurema Jos√© Vunge</option>
<option>Karine Cristina dos Santos</option>
<option>Kelanny Nonata de Sousa Paiva</option>
<option>Lara Filipa Marques Tentugal Dos Santos</option>
<option>Lara Maria Marques Brand√£o</option>
<option>Lara Maria Ribeiro Calheiros</option>
<option>Leticia Rodrigues Andrade</option>
<option>L√≠dia Silvestre Dos Santos Oliveira</option>
<option>Liliana Alexandra Chenque Seixas</option>
<option>Liliana Sofia Fernandes Correia</option>
<option>Luana C√¢ndida Batista Crema</option>
<option>Lu√≠s Paulo De Carvalho</option>
<option>Lu√≠sa Cristina Parreira Balegas</option>
<option>Luzia Madalena Teixeira Alves Quintas</option>
<option>Maria Eugenia de Moraes Pereira</option>
<option>Maria Rosa Tesnitskaia Machado</option>
<option>Maria Thais Alves Batista</option>
<option>Maria Luiza de Souza Batista</option>
<option>M√°rio F√°bio Filipe Campos</option>
<option>Mateus Barroso De Sousa</option>
<option>Matheus Wesley Matos Lima</option>
<option>N√°dia Raquel Monteiro Homem</option>
<option>Nat√°lia Zorzi De Oliveira</option>
<option>Natividade La Salete Moreira De Sousa Concei√ß√£o</option>
<option>Nelson Alexandre Pinto Martins</option>
<option>Noemi de F√°tima Concei√ß√£o Colubali</option>
<option>Nuno Miguel da Cruz Machado</option>
<option>P√¢mella Oliveira Rios E Souza</option>
<option>Patr√≠cia Alexandra Santana Lurdes</option>
<option>Ricardo Miguel Pinto Seabra</option>
<option>Rita Andreia Miranda Jorge</option>
<option>Rosa Martins da Palma Alves</option>
<option>Samuel Duarte Vieira</option>
<option>Samyra Cilene Gomes Da Silva</option>
<option>Sara Pat√≠cia Duarte e Oliveira Mendes </option>
<option>S√≥nia Aissat√∫ Djal√≥</option>
<option>Suellen dos Santos Nascimento Alves</option>
<option>Tatiana de F√°tima Gon√ßalves Santos Pi√ßarra</option>
<option>Thaynara Kelly da Silva Pereira</option>
<option>Tiago Mulari Di Pelli</option>
<option>Tiago Emanuel Nunes dos Santos</option>
<option>Val√©ry Ant√≥nio Granja Eleut√©rio</option>
<option>Virginia Rodrigues dos Santos</option>
<option>Yasmin Chaia Soares Coelho</option>
<option>Yasmin Marchezi Lingenover</option>
<option>Yngrid Vaz Rossim</option>



</select>

<label for="tipoDias">Tipo de Dias:</label>
<select id="tipoDias" required>
    <option value="F25">F√©rias 2025</option>
    <option value="Preferenciais">2026 - Preferenciais</option>
    <option value="N√£o Preferenciais">2026 - N√£o Preferenciais</option>
</select>

<label for="dataInicio">Data de In√≠cio:</label>
<input type="date" id="dataInicio" required>

<label for="dataFim">Data de Fim:</label>
<input type="date" id="dataFim" required>

<div id="diasCalculados">Dias √∫teis calculados: 0</div>

<div id="errorMessages" class="error"></div>
<div id="successMessage" class="success"></div>

<button type="submit">Enviar</button>
</form>

<div id="resumoPedidos"></div>
</div>

<!-- SUPABASE SCRIPT -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
const { createClient } = supabase;

const supabaseClient = createClient(
    "https://bijndfsxrzjviwrdvwms.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpam5kZnN4cnpqdml3cmR2d21zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4NTA5NTIsImV4cCI6MjA2NjQyNjk1Mn0.EWaFInuqTaxvnjytb40DdnflEbBrbSYcViKLYc_kKBk"
);

const feriados = [
    "2026-01-01", // 01/01/2026 - Ano Novo
    "2026-04-03", // 03/04/2026 - Sexta-feira Santa
    "2026-05-01", // 01/05/2025 - Dia do Trabalhador
    "2026-06-04", // 04/06/2026 - Corpo de Deus
    "2026-06-10", // 10/06/2026 - Dia de Portugal, Cam√µes e Comunidades Portuguesas
    "2026-10-05", // 05/10/2026 - Implanta√ß√£o da Rep√∫blica
    "2026-12-01", // 01/12/2026 - Restaura√ß√£o da Independ√™ncia
    "2026-12-08", // 08/12/2026 - Imaculada Concei√ß√£o
    "2026-12-25"  // 25/12/2026 - Natal
];



function listarConflitosFDS_FERIADOS(dataInicio, dataFim) {
    let finsSemana = [];
    let feriadosEncontrados = [];

    let start = new Date(dataInicio);
    let end = new Date(dataFim);

    for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
        let f = d.toISOString().split("T")[0];
        let dia = d.getDay();

        if (dia === 0 || dia === 6) {
            finsSemana.push(f);
        } 
        else if (feriados.includes(f)) {
            feriadosEncontrados.push(f);
        }
    }

    return {
        finsSemana,
        feriados: feriadosEncontrados
    };
}

function calcularDiasEntreDatas(dataInicio,dataFim){
    const start = new Date(dataInicio);
    const end = new Date(dataFim);
    let dias = 0;
    for(let d=new Date(start); d<=end; d.setDate(d.getDate()+1)){
        const f = d.toISOString().split("T")[0];
        const dia = d.getDay();
        if(dia===0 || dia===6 || feriados.includes(f)) continue;
        dias++;
    }
    return dias;
}

// Atualizar dias √∫teis dinamicamente
function atualizarDiasCalculados() {
    const dataInicio = document.getElementById("dataInicio").value;
    const dataFim = document.getElementById("dataFim").value;

    if(dataInicio && dataFim){
        const totalDias = calcularDiasEntreDatas(dataInicio,dataFim);
        document.getElementById("diasCalculados").innerText = `Dias √∫teis calculados: ${totalDias}`;
    } else {
        document.getElementById("diasCalculados").innerText = "Dias √∫teis calculados: 0";
    }
}

document.getElementById("dataInicio").addEventListener("change", atualizarDiasCalculados);
document.getElementById("dataFim").addEventListener("change", atualizarDiasCalculados);

async function verificarDatasDuplicadas(nome,dataInicio,dataFim){
    const { data } = await supabaseClient
        .from("wrt_inboundpt")
        .select("data_inicio,data_fim")
        .eq("nome",nome);

    const inicioNovo = new Date(dataInicio);
    const fimNovo = new Date(dataFim);

    return data.filter(p=>{
        const inicio = new Date(p.data_inicio);
        const fim = new Date(p.data_fim);
        return inicioNovo <= fim && fimNovo >= inicio;
    });
}

async function verificarLimites(nome,tipoDias,diasNovo){
    const limites = {
"Jessica Silva Nogueira Manacas": { "F25": 8, "Preferenciais": 7, "N√£o Preferenciais": 0 },
"Lu√≠sa Cristina Parreira Balegas": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Natividade La Salete Moreira De Sousa Concei√ß√£o": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Adriana Fiorani Ferreira": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Alberto Dos Santos Fritsch": { "F25": 5, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Ana Beatriz Pereira Foitinho Resina De Oliveira": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Ana Carolina Mota Ferreira": { "F25": 45, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Ana Filipa Mendes Do Carmo": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Ana Pedro de Mendon√ßa Batista dos Santos": { "F25": 13, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Ana Raquel Ferreira Da Fonseca": { "F25": 3, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Ana Rute da Silva Fernandes Dur√£o": { "F25": 8, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Ana Sofia Sanches Coelho da Cunha de Oliveira": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 6 },
"Ana Teresa Da Costa Leonardo Neves": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Andreia Cristina Silvestre Ferreira Da Silva Bernardes": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Andreia Lorena Matos Pereira": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Andreia Meireles Costa": { "F25": 13, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"B√°rbara Cristina Machado Fernandes": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Beatriz De Jesus Pimentel": { "F25": 0, "Preferenciais": 0, "N√£o Preferenciais": 0 },
"Beatriz De Oliveira Guimar√£es": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Beatriz Santana Pereira ": { "F25": 5, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Bruno Pinto da Silva": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
        "Ana Raquel Ferreira Pico Martins": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Emeli Santana da Silva": { "F25": 3, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Constan√ßa De Freitas Lima Monteiro Lopes": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },

"Carina Brito Oliveira Duarte": { "F25": 8, "Preferenciais": 0, "N√£o Preferenciais": 0 },
"C√°tia Filipa Nunes Rodrigues": { "F25": 15, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Christian Acampora": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 10 },
"Cintia Maisa Gomes Carlos": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Claudia Nogueira Gon√ßalves": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Clotilde De Jesus Pires Maciel Neto": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Cristiane Andrea e Paiva": { "F25": 5, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Daiana Mangolin De Oliveira Ghenov": { "F25": 4, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Daniel Andrade Pires Belas Brand√£o": { "F25": 2, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Daniel Eduardo Henriques Pinheiro": { "F25": 5, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Darlene Do Nascimento Lima Ching Fong": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Delson da Silva Carvalho": { "F25": 12, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Diana Da Silva Ferreira": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Eunice Rosalina Moiane Machatine Chiau": { "F25": 6, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Fabiana Dos Reis Moreira": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"F√°tima Leticia Barbosa Coutinho": { "F25": 5, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Filipa Alexandra Nogueira Leit√£o": { "F25": 20, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Fl√°via Passos Messias": { "F25": 4, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Helga Maria Fernandes Levy Lopes": { "F25": 4, "Preferenciais": 10, "N√£o Preferenciais": 12 },
        "Jo√£o Pedro Concei√ß√£o Borges": { "F25": 12, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Hellen Priscilla De Freitas P√™go Saless": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Hugo Miguel dos Santos Pombo": { "F25": 6, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Isabel Alexandra B√°rtolo Louren√ßo Lopes": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Ivo Miguel Cardoso Pereira": { "F25": 2, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Jaqueline de Freitas Andrade Maia": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Jaqueline Elias de Lima": { "F25": 4, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Joana Gabriela de Paiva da Silva": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Joana Gomes Neves Tomaz": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Jo√£o Pedro Reis Almeida": { "F25": 12, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Jorge Miguel Santos de Seixas": { "F25": 5, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Jorge Tiago Miranda Nogueira": { "F25": 6, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Jos√© Filipe Miranda Monteiro": { "F25": 5, "Preferenciais": 10, "N√£o Preferenciais": 10 },
"Jurema Jos√© Vunge": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Karine Cristina dos Santos": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Kelanny Nonata de Sousa Paiva": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Lara Filipa Marques Tentugal Dos Santos": { "F25": 4, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Lara Maria Marques Brand√£o": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Lara Maria Ribeiro Calheiros": { "F25": 4, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Leticia Rodrigues Andrade": { "F25": 6, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"L√≠dia Silvestre Dos Santos Oliveira": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Liliana Alexandra Chenque Seixas": { "F25": 20, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Liliana Sofia Fernandes Correia": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Luana C√¢ndida Batista Crema": { "F25": 4, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Lu√≠s Paulo De Carvalho": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Luzia Madalena Teixeira Alves Quintas": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Maria Eugenia de Moraes Pereira": { "F25": 20, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Maria Rosa Tesnitskaia Machado": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Maria Thais Alves Batista": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"M√°rio F√°bio Filipe Campos": { "F25": 1, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Mateus Barroso De Sousa": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Matheus Wesley Matos Lima": { "F25": 4, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"N√°dia Raquel Monteiro Homem": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Nat√°lia Zorzi De Oliveira": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 11 },
"Nelson Alexandre Pinto Martins": { "F25": 5, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Noemi de F√°tima Concei√ß√£o Colubali": { "F25": 4, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Nuno Miguel da Cruz Machado": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"P√¢mella Oliveira Rios E Souza": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Patr√≠cia Alexandra Santana Lurdes": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Ricardo Miguel Pinto Seabra": { "F25": 8, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Rita Andreia Miranda Jorge": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Rosa Martins da Palma Alves": { "F25": 5, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Samuel Duarte Vieira": { "F25": 6, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Samyra Cilene Gomes Da Silva": { "F25": 5, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Sara Pat√≠cia Duarte e Oliveira Mendes ": { "F25": 12, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"S√≥nia Aissat√∫ Djal√≥": { "F25": 5, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Suellen dos Santos Nascimento Alves": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Tatiana de F√°tima Gon√ßalves Santos Pi√ßarra": { "F25": 4, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Thaynara Kelly da Silva Pereira": { "F25": 4, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Tiago Mulari Di Pelli": { "F25": 2, "Preferenciais": 10, "N√£o Preferenciais": 7 },
"Val√©ry Ant√≥nio Granja Eleut√©rio": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Virginia Rodrigues dos Santos": { "F25": 5, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Yasmin Chaia Soares Coelho": { "F25": 5, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Yasmin Marchezi Lingenover": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Dyovana Gon√ßalves Farias": { "F25": 3, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Afonso Guilherme Larrier Kroner Torres Nunes": { "F25": 1, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Jaine Hanara Evangelista dos Santos": { "F25": 1, "Preferenciais": 10, "N√£o Preferenciais": 12 },
"Maria Luiza de Souza Batista": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 10 },
"Tiago Emanuel Nunes dos Santos": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 10 },
"Yngrid Vaz Rossim": { "F25": 0, "Preferenciais": 10, "N√£o Preferenciais": 10 }

    };

    const { data } = await supabaseClient
        .from("wrt_inboundpt")
        .select("total_dias,tipo_dias")
        .eq("nome",nome)
        .eq("tipo_dias",tipoDias);

    let usados = data.reduce((s,p)=>s+p.total_dias,0);
    let limite = limites[nome][tipoDias];

    if(usados + diasNovo > limite){
        return { pode:false, limiteTotal: limite };
    }
    return { pode:true };
}

// Per√≠odos bloqueados
const bloqueios = [
    { inicio: "2026-11-01", fim: "2026-12-30", excecao: "2026-12-24" }, // Deze
    { inicio: "2026-01-01", fim: "2026-01-15" } // Janeiro 1¬™ quinzena
];

function intervaloBloqueado(d1, d2, bloqueios){
    let start = new Date(d1);
    let end = new Date(d2);

    for(let d=new Date(start); d<=end; d.setDate(d.getDate()+1)){
        let f = d.toISOString().split("T")[0];
        for(let b of bloqueios){
            if(f >= b.inicio && f <= b.fim && (!b.excecao || f !== b.excecao)){
                return true;
            }
        }
    }
    return false;
}

document.getElementById("reservaForm").addEventListener("submit", async(e)=>{
    e.preventDefault();

    const nome = document.getElementById("nome").value;
    const tipoDias = document.getElementById("tipoDias").value;
    const dataInicio = document.getElementById("dataInicio").value;
    const dataFim = document.getElementById("dataFim").value;

    if(tipoDias === "F25"){
        const limiteF25 = "2026-04-30";
        if(dataInicio > limiteF25 || dataFim > limiteF25){
            document.getElementById("errorMessages").innerText =
            "‚ùå F√©rias 2025 s√≥ podem ser marcadas at√© 30/04/2026.";
            document.getElementById("errorMessages").style.display="block";
            return;
        }
    }

    if(intervaloBloqueado(dataInicio, dataFim, bloqueios)){
        document.getElementById("errorMessages").innerText =
        "‚ùå Datas bloqueadas ( M√™s de Novembro e Dezembro,exceto 24/12/2026 e 31/12/2026).";
        document.getElementById("errorMessages").style.display="block";
        return;
    }

  const conflitos = listarConflitosFDS_FERIADOS(dataInicio, dataFim);
let mensagensErro = [];

if (conflitos.finsSemana.length > 0) {
    mensagensErro.push(
        "‚ùå O pedido n√£o pode conter Fins de Semana: " + conflitos.finsSemana.join(", ")
    );
}

if (conflitos.feriados.length > 0) {
    mensagensErro.push(
        "‚ùå O pedido n√£o pode conter Feriados, caso pretendas usufruir do feriado deves agendar o dia √∫til anterior e posterior ao mesmo : " + conflitos.feriados.join(", ")
    );
}

if (mensagensErro.length > 0) {
    document.getElementById("errorMessages").innerHTML = mensagensErro.join("<br>");
    document.getElementById("errorMessages").style.display = "block";
    return;
}


    const totalDias = calcularDiasEntreDatas(dataInicio,dataFim);

    const duplicadas = await verificarDatasDuplicadas(nome,dataInicio,dataFim);
    if(duplicadas.length > 0){
        let conflitoMsg = duplicadas.map(c=>`${c.data_inicio} a ${c.data_fim}`).join(", ");
        document.getElementById("errorMessages").innerText =
        "‚ùå Datas em conflito: " + conflitoMsg;
        document.getElementById("errorMessages").style.display="block";
        return;
    }

    const limite = await verificarLimites(nome,tipoDias,totalDias);
    if(!limite.pode){
        let msg = "";
        let autorizados = limite.limiteTotal;

        if(tipoDias === "F25"){
            msg = `‚ùå ${autorizados} dias autorizados em F√©rias 2025.`;
        }
        else if(tipoDias === "Preferenciais"){
            msg = `‚ùå ${autorizados} dias autorizados em Preferenciais 2026.`;
        }
        else if(tipoDias === "N√£o Preferenciais"){
            msg = `‚ùå ${autorizados} dias autorizados em N√£o Preferenciais 2026.`;
        }

        document.getElementById("errorMessages").innerText = msg;
        document.getElementById("errorMessages").style.display="block";
        return;
    }

    await supabaseClient.from("wrt_inboundpt").insert([{
        nome,
        tipo_dias: tipoDias,
        data_inicio: dataInicio,
        data_fim: dataFim,
        total_dias: totalDias
    }]);

    document.getElementById("successMessage").innerText =
    `‚úîÔ∏è Pedido Registado: ${nome} (${tipoDias}) ${dataInicio} a ${dataFim} (${totalDias} dias √∫teis)`;
    document.getElementById("errorMessages").style.display="none";

    const div = document.createElement("div");
    div.innerHTML = `
        <strong>Pedido Registado:</strong><br>
        Nome: ${nome}<br>
        Tipo: ${tipoDias}<br>
        Data In√≠cio: ${dataInicio}<br>
        Data Fim: ${dataFim}<br>
        Dias √öteis: ${totalDias}
    `;
    document.getElementById("resumoPedidos").appendChild(div);

    e.target.reset();
    document.getElementById("diasCalculados").innerText = "Dias √∫teis calculados: 0";
});

document.getElementById("btnEntrar").addEventListener("click",()=>{
    if(document.getElementById("password").value === "WRTInbound*2026"){
        document.getElementById("passwordPrompt").style.display="none";
        document.getElementById("formContainer").style.display="block";
    } else {
        document.getElementById("senhaErro").style.display="block";
    }
});
</script>

</body>
</html>
